<!doctype html>
<html lang="en">
<head>
    {% import "macros.html" as macros %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="#8c428a">
    <title>{% block title %}{% endblock %}— The Clowder Project</title>
    <meta name="description" content="a collection of personal notes on mathematics and physics">
    <link rel="icon" type="image/vnd.microsoft.icon" href="/static/images/favicon.png">

    <!-- Vendor CSS -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" integrity="sha384-yBEPaZw444dClEfen526Q6x4nwuzGO6PreKpbRVSLFCci3oYGE5DnD1pNsubCxYW" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/jquery.bonsai.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/discord-widget.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/theorem-environments.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/list-spacing.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/preferences.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/print.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dark-mode.css') }}">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Noto+Sans+TC:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:ital,wght@0,400;0,500;1,400;1,500&family=Alegreya:ital,wght@0,400;0,700;1,400;1,700&family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Charis+SIL:ital,wght@0,400;0,700;1,400;1,700&family=Crimson+Pro:ital,wght@0,400;0,600;1,400;1,600&family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,700&family=EB+Garamond:ital,wght@0,400;0,700;1,400;1,700&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Vendor JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js" integrity="sha384-cd07Jx5KAMCf7qM+DveFKIzHXeCSYUrai+VWCPIXbYL7JraHMFL/IXaCKbLtsxyB" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.bonsai.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>

    <!-- MathJax Configuration -->
    {% raw %}
    <script>
    window.MathJax = {
      loader: {load: ['[tex]/ams','[tex]/mathtools','[tex]/require','[tex]/color','[tex]/configmacros','[tex]/html','[tex]/centernot','[tex]/boldsymbol']},
      tex: {
        macros: {
          linebreak: ["", 1, ""],
          webleft: ["\\mathopen{}\\left #1", 1],
          webright: ["\\right #1\\mathclose{}", 1]
        },
        environments: {
          bgroup: ["", 1] // Bypass for plastex issue #384
        },
        tagSide: 'right',
        inlineMath: [['$','$']],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        packages: ['base', 'ams', 'mathtools', 'configmacros', 'require', 'color', 'html', 'centernot','boldsymbol']
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
    {% endraw %}

    {% block head %}{% endblock %}

    <style>
    table { border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #dddddd; text-align: center; padding: 4px; }
    tr:nth-child(even) { background-color: #dddddd; }
    .dark-mode tr:nth-child(even) { background-color: #1F1F1F; }
    </style>
    <style id="code-dynamic-style">
    </style>
    {% raw %}
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        /**
         * ------------------------------------------------------------------------
         * App Initializers
         * ------------------------------------------------------------------------
         */
        document.head.insertAdjacentHTML('beforeend', '<style id="mathjax-dynamic-style"></style>');
        initTheme();
        initPreferencesMenu();
        initFontSelection();
        initImageResizing();
        initContactForm();
        initPopovers();
    
        /**
         * ------------------------------------------------------------------------
         * Theme (Dark/Light Mode) with DEBUG LOGGING
         * ------------------------------------------------------------------------
         */
        function initTheme() {
            console.log("Initializing theme...");
            const themeToggle = document.getElementById('color_mode');
            const osPreference = window.matchMedia('(prefers-color-scheme: dark)');
    
            // Check for a saved preference in localStorage
            let userPreference = localStorage.getItem('theme');
            console.log(`Found in localStorage: theme = ${userPreference}`);
    
            let isDarkMode;
    
            // Determine the initial theme
            if (userPreference) {
                console.log("Using stored preference.");
                isDarkMode = userPreference === 'dark';
            } else {
                console.log("No stored preference found. Checking OS setting.");
                isDarkMode = osPreference.matches;
                console.log(`OS prefers dark mode: ${isDarkMode}`);
            }
    
            // Apply the determined theme and update the toggle's state
            themeToggle.checked = isDarkMode;
            applyTheme(isDarkMode);
    
            // Listen for changes from the manual toggle
            themeToggle.addEventListener('change', function() {
                const newTheme = this.checked ? 'dark' : 'light';
                console.log(`Toggle changed. Saving theme to localStorage: '${newTheme}'`);
                localStorage.setItem('theme', newTheme); // Save the manual choice
                applyTheme(this.checked);
            });
    
            // Listen for changes in OS preference
            osPreference.addEventListener('change', (e) => {
                // We only act on this if the user has NOT made a manual choice
                if (!localStorage.getItem('theme')) {
                    console.log(`OS theme changed. Applying theme: ${e.matches ? 'dark' : 'light'}`);
                    applyTheme(e.matches);
                    themeToggle.checked = e.matches;
                } else {
                    console.log("OS theme changed, but ignoring because a manual preference is saved.");
                }
            });
    
            // Add a mutation observer for the theme to handle sun/moon glow
            const themeObserver = new MutationObserver(() => updateSunMoonGlow());
            themeObserver.observe(document.body, {
                attributes: true,
                attributeFilter: ['class']
            });
            updateSunMoonGlow(); // Initial check
        }
    
        function applyTheme(isDarkMode) {
            console.log(`Applying theme: ${isDarkMode ? 'dark-mode' : 'light-mode'}`);
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.body.classList.toggle('light-mode', !isDarkMode);
    
            // Update background overlay if preferences menu is open
            const menu = document.getElementById('preferencesMenu');
            if (menu.style.display === 'block') {
                document.body.classList.toggle('darkened', isDarkMode);
                document.body.classList.toggle('lightened', !isDarkMode);
            }
    
            // Update image sources for the current theme
            updateImageSources(isDarkMode);
        }
    
        function updateImageSources(isDarkMode) {
            const imageSelectors = '.webcompile img, .webprooftree img, .scalewebprooftree img, .tikz-cd img, .scalemath img, .webgif img';
            document.querySelectorAll(imageSelectors).forEach(img => {
                const pathParts = ['/dark-mode/', '/static/tikzcd-images/', '/static/scalewebprooftree-images/', '/static/webprooftree-images/', '/static/webcompile-images/', '/static/scalemath-images/', '/static/gifs/'];
                let currentPath = img.src;
                let basePath = pathParts.find(p => currentPath.includes(p) && p !== '/dark-mode/');
                
                if (basePath) {
                    if (isDarkMode && !currentPath.includes('/dark-mode/')) {
                        img.src = currentPath.replace(basePath, basePath + 'dark-mode/');
                    } else if (!isDarkMode && currentPath.includes('/dark-mode/')) {
                        img.src = currentPath.replace(basePath + 'dark-mode/', basePath);
                    }
                }
            });
    
            // Special handling for footnote content stored in data attributes
            document.querySelectorAll('.footnote').forEach(footnote => {
                let content = footnote.getAttribute('data-content');
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                doc.querySelectorAll('img').forEach(img => {
                     // Simplified logic for brevity, can be expanded like above if needed
                     if (isDarkMode && !img.src.includes('/dark-mode/')) {
                        img.src = img.src.replace('/static/', '/static/dark-mode/');
                     } else if (!isDarkMode && img.src.includes('/dark-mode/')) {
                        img.src = img.src.replace('/dark-mode/', '/');
                     }
                });
                footnote.setAttribute('data-content', doc.body.innerHTML);
            });
        }
    
        function updateSunMoonGlow() {
            const moonElement = document.getElementById('moon');
            const sunElement = document.getElementById('sun');
            const isDarkMode = document.body.classList.contains('dark-mode');
    
            if (moonElement && sunElement) {
                moonElement.style.color = isDarkMode ? '#ffffff' : '';
                moonElement.style.textShadow = isDarkMode ? '0 0 8px #ffffff, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)' : '';
                sunElement.style.color = !isDarkMode ? '#EB9B34' : '';
                sunElement.style.textShadow = !isDarkMode ? '0 0 8px #EB9B34, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)' : '';
            }
        }
    
    
        /**
         * ------------------------------------------------------------------------
         * Preferences Menu
         * ------------------------------------------------------------------------
         */
        function initPreferencesMenu() {
            const menu = document.getElementById('preferencesMenu');
            const openBtn = document.getElementById('settingsButton');
            const closeBtn = document.getElementById('closeButton');
            const mainContent = document.querySelector('.main-content');
    
            const closeMenu = () => {
                menu.style.display = 'none';
                document.body.classList.remove('darkened', 'lightened');
                mainContent.style.pointerEvents = 'auto';
            };
    
            const openMenu = () => {
                menu.style.display = 'block';
                document.body.classList.toggle('darkened', document.body.classList.contains('dark-mode'));
                document.body.classList.toggle('lightened', !document.body.classList.contains('dark-mode'));
                mainContent.style.pointerEvents = 'none';
            };
    
            openBtn.addEventListener('click', (event) => {
                openMenu();
                event.stopPropagation();
            });
    
            closeBtn.addEventListener('click', closeMenu);
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') closeMenu();
            });
            document.addEventListener('click', (event) => {
                if (menu.style.display === 'block' && !menu.contains(event.target) && !openBtn.contains(event.target)) {
                    closeMenu();
                }
            });
        }
    
        /**
         * ------------------------------------------------------------------------
         * Font Selection
         * ------------------------------------------------------------------------
         */
        function initFontSelection() {
            // This configuration now includes a 'mathjax' key for custom scaling.
            // Adjust the percentage values here to fine-tune the look for each font.
            const fontConfig = {
                'Alegreya Sans':        { body: '14pt',   preferencesMenu: '14pt',   mathjax: '105%', code: '85%' },
                'Alegreya':             { body: '13pt',   preferencesMenu: '13pt',   mathjax: '110%', code: '90%'  },
                'Atkinson Hyperlegible':{ body: '12.5pt', preferencesMenu: '12.5pt', mathjax: '115%', code: '93%'  },
                'Charis SIL':           { body: '12pt',   preferencesMenu: '12pt',   mathjax: '117.5%', code: '92%'  },
                'Crimson Pro':          { body: '14pt',   preferencesMenu: '14pt',   mathjax: '102.5%', code: '86%'  },
                'Crimson Text':         { body: '14pt',   preferencesMenu: '14pt',   mathjax: '102.5%', code: '83%'  },
                'Noto Sans':            { body: '12pt',   preferencesMenu: '12pt',   mathjax: '121.4%', code: '100%'  },
                'EB Garamond':          { body: '14pt',   preferencesMenu: '14pt',   mathjax: '100%', code: '80%'  },
                'PT Serif':             { body: '12pt',   preferencesMenu: '12pt',   mathjax: '115%', code: '95%'  },
            };
    
            const fontSelect = document.getElementById('fontSelection');
            const mathjaxStyleElement = document.getElementById('mathjax-dynamic-style');
            const codeStyleElement = document.getElementById('code-dynamic-style');
    
            const setFont = (fontName) => {
                const config = fontConfig[fontName];
                if (!config) return;
    
                // 1. Set body and menu font (existing logic)
                document.body.style.fontFamily = fontName;
                document.body.style.fontSize = config.body;
                const preferencesMenu = document.getElementById('preferencesMenu');
                if (preferencesMenu) {
                    preferencesMenu.style.fontSize = config.preferencesMenu;
                }
    
                // 2. Update MathJax font size (new logic)
                if (mathjaxStyleElement && config.mathjax) {
                    mathjaxStyleElement.innerHTML = `
                        mjx-container {
                            font-size: ${config.mathjax} !important;
                        }
                    `;
                }
                // 3. Update code font size
                if (codeStyleElement && config.code) {
                    codeStyleElement.innerHTML = `
                        .codeColor { font-size: ${config.code} !important; }
                    `;
                }
            };
    
            fontSelect.addEventListener('change', function() {
                setFont(this.value);
                localStorage.setItem('font', this.value);
            });
    
            const storedFont = localStorage.getItem('font') || 'Alegreya Sans';
            fontSelect.value = storedFont;
            setFont(storedFont);
        }
    
        /**
         * ------------------------------------------------------------------------
         * Image Utilities (Resize, Zoom)
         * ------------------------------------------------------------------------
         */
        function initImageResizing() {
            const maxWidth = 500;
            const resizeFactor = 1.1;
            const imageSelectors = '.webprooftree img, .scalewebprooftree img, .webcompile img, .tikz-cd img, .scalemath img';
            
            document.querySelectorAll(imageSelectors).forEach(img => {
                const setWidth = () => {
                    const newWidth = img.naturalWidth * resizeFactor;
                    img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
                };
                
                if (img.complete) {
                    setWidth();
                } else {
                    img.addEventListener('load', setWidth);
                }
            });
        }
    
        /**
         * ------------------------------------------------------------------------
         * Miscellaneous Initializers
         * ------------------------------------------------------------------------
         */
        function initContactForm() {
            const form = document.getElementById("staticform");
            if (!form) return;
            form.addEventListener("submit", function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                fetch(form.action, {
                    method: "POST",
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || "Form submitted successfully!");
                    form.reset();
                })
                .catch(error => {
                    alert("An error occurred. Please try again.");
                    console.error(error);
                });
            });
        }
    
        function initPopovers() {
            $('[data-toggle="popover"]').popover();
        }
    });
    </script>
{% endraw %}
</head>
<body>
<div id="preferencesMenu" class="preferences" style="display: none;">
    <div>
        <div class="preferences-header">Preferences</div>
        <button id="closeButton" class="close-btn">×</button>
        <div class="btn-container" style="display: flex !important;">
            <span id="sun" class="material-symbols-outlined" style="margin-right: 1rem"></span><div>  </div>
            <label class="switch btn-color-mode-switch">
                <input type="checkbox" name="color_mode" id="color_mode" value="0">
                <label for="color_mode" data-on="Dark" data-off="Light" class="btn-color-mode-switch-inner"></label>
            </label>
            <div>  </div><span id="moon" class="material-symbols-outlined" style="margin-left: 1rem"></span>
        </div>
        <div class="preference-item"><div><b>Website&nbsp;Typeface:&nbsp;</b></div>
            <select id="fontSelection">
                <option value="Alegreya Sans">Alegreya Sans</option>
                <option value="Atkinson Hyperlegible">Atkinson Hyperlegible</option>
                <option value="Alegreya">Alegreya</option>
                <option value="Charis SIL">Charis SIL</option>
                <option value="Crimson Pro">Crimson Pro</option>
                <option value="Crimson Text">Crimson Text</option>
                <option value="EB Garamond">EB Garamond</option>
                <option value="Noto Sans">Noto Sans</option>
                <option value="PT Serif">PT Serif</option>
            </select>
        </div>
        <hr>
        <p style="text-align:left;">The following options control the appearance of downloadable PDF files:</p>
        <div class="preference-item"><div><b>PDF&nbsp;Theorem&nbsp;Style:&nbsp;</b></div>
            <select id="theoremStyleSelection">
                <option value="tcbthm">Standard (tcbthm)</option>
                <option value="amsthm">Simple (amsthm)</option>
            </select>
        </div>
        <div class="preference-item"><div><b>PDF&nbsp;Typeface:&nbsp;</b></div>
            <select id="pdfTypefaceSelection">
                <option value="alegreya-sans">Alegreya Sans</option>
                <option value="alegreya">Alegreya</option>
                <option value="eb-garamond">EB Garamond</option>
                <option value="crimson-pro">Crimson Pro</option>
                <!--<option value="xcharter">XCharter</option>-->
                <option value="cm">Computer Modern</option>
            </select>
        </div>
        <p style="text-align:left;margin-bottom:0.25em;">“Theorem Style” toggles between boxed environments (<code>tcbthm</code>) and simple layouts (<code>amsthm</code>).</p>
        <p style="text-align:left;"><i>The default option is Alegreya Sans with <code>tcbthm</code> environments.</i></p>
    </div>
</div>
<div class="main-content">
  <div class="container-fluid bounded">
    <div id="first-bar" class="row topbar inner-top top">
      <header class="col">
        <h1><a href="/"><div class="title">The Clowder Project</div></a></h1>
      </header>
  
      <nav id="header">
        <ul id="quicklinks">
          <li><span class="mobile-hide bar-icon-text"><a href="/"><span class="bar-icon material-symbols-outlined">home</span><span class="bar-text" style="transform: scale(1.1) translateX(-1px) translateY(-6.5px) !important;">Home</span></a></span></li>
          <li><span class="mobile-hide bar-icon-text"><a href="/changes"><span class="bar-icon material-symbols-outlined">history</span><span class="bar-text" style="transform: scale(1.1) translateX(0px) translateY(-6.5px) !important;">Changes</span></a></span></li>
          <li><span class="mobile-hide bar-icon-text"><a href="/bibliography"><span class="bar-icon material-symbols-outlined" style="padding-right: 3px;">menu_book</span><span class="bar-text" style="transform: scale(1.1) translateX(0px) translateY(-6.5px) !important;">Bibliography</span></a></span></li>
          <li id="settings-nav-item"><span class="bar-icon-text"><button id="settingsButton"><span class="bar-icon material-symbols-outlined">settings</span><span class="bar-text" style="transform: scale(1.1) translateX(0px) translateY(-6.5px);">Settings</span></span></button></span></li>
        </ul>
      </nav>
    </div>
  
    <nav id="second-bar" class="row topbar sticky-top">
      {% if self.breadcrumb() %}
        <ul class="col-11 col-sm-11 col-md-11 col-lg-12 col-xl-12" id="crumbs">
          <li><a href="/browse">Table of Contents</a></li>
          {% block breadcrumb %}{% endblock %}
        </ul>
      {% endif %}
  
      {% if self.hamburger() %}
        <div class="col-1 col-sm-1 col-md-1" id="burger">
          <input type="checkbox" id="burger-input"></input>
  
          <label id="burger-icon" for="burger-input">
            <span id="top-bun"></span>
            <span id="meat"></span>
            <span id="bottom-bun"></span>
          </label>
  
          <div id="burger-content">
            {% block hamburger %}{% endblock %}
          </div>
        </div>
      {% endif %}
  
      {% if self.tagline() %}
        {% block tagline %}{% endblock %}
      {% endif %}
    </nav>
  
    <div class="row" id="content">
      <section id="main" class="col-xs-12 col-sm-12 col-md-12 col-lg-8 col-xl-8">
        {% block body %}{% endblock %}
      </section>
        <div class="col-lg-4 col-xl-4">
          <section id="meta" class="row topbar sticky-top">
          {% if tag is defined %}
            <div class="right-interaction-box">
          {% endif %}
          {% block sidebar %}{% endblock %}
          {% if tag is defined %}
            <div class="statistics-cite">
              <a class="statistics-link" href="/tag/{{ tag.tag }}/statistics"><span class="dark-svg"><img class="statistics-img" src="/static/images/graph.svg"></span> Statistics</a>
              <a class="cite-link" href="/tag/{{ tag.tag }}/cite">Cite  <span class="dark-svg"><img class="cite-img" src="/static/images/cite.svg"></span></a>
            </div>
            </div>
            <hr>
            <div class="contact-box">
                <p>Noticed something off, or have any comments? Feel free to reach out!</p>
                <ul>
                    <li><span class="counter-inner-no-tag">•</span><a class="no-bg" href="mailto:emily.de.oliveira.santos.tmf@gmail.com">Email <span class="dark-svg"><img class="email-icon" src="/static/images/email.svg"></span></a>
                    <!--<li><span class="counter-inner-no-tag">•</span><a href="https://twitter.com/emily_etale">Twitter <span class="dark-svg"><img class="twitter-icon" src="/static/images/twitter.svg"></span></a>-->
                    <li><span class="counter-inner-no-tag">•</span><a href="https://discord.gg/b98uG2MWgc">Discord <span class="dark-svg"><img class="discord-icon" src="/static/images/discord.svg"></span></a>
                </ul>
                <hr>
                You can also use the contact form below:
                <br>
                <div class="contact-form-container">
                  <div class="columns">
                    <div class="column is-half">
                      <form action="https://api.staticforms.xyz/submit" method="post" id="staticform">
                        <input type="hidden" name="accessKey" value="406a3bad-091e-4921-87a3-1a564e044b6b">
                        <input type="hidden" name="subject" value="New comment from the Clowder Project">
                        <div class="field">
                          <label class="contact-label"><b>Name</b></label>
                          <div class="control">
                            <input class="input" type="text" name="name" placeholder="Enter Your Name" required>
                          </div>
                        </div>
                        <div class="field">
                          <label class="contact-label"><b>Email</b></label>
                          <div class="control">
                            <input class="input" type="email" name="email" placeholder="Enter Your Email" required>
                          </div>
                        </div>
                        <div class="field">
                          <label class="contact-label"><b>Message</b></label>
                          <div class="control">
                            <textarea class="textarea" name="message" placeholder="Enter Your Message" required></textarea>
                          </div>
                        </div>
                        <button class="contact-form-submit-button button is-primary" type="Submit">Submit</button>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
          {% endif %}
        </section>
      </div>
    </div>
  </div>
  <div id="footnote-box" class="hidden">
      <span id="footnote-content"></span>
  </div>
</div>

<script>
    window.onload = function() {
        // Maximum allowed width for images
        var maxWidth = 575; // You can adjust this value as per your requirement

        // Select all img tags within divs with class scalewebprooftree, webprooftree, scalemath, webcompile or tikzcd

        var scalewebprooftree_images = document.querySelectorAll('.scalewebprooftree img');

        // Loop through each selected image
        scalewebprooftree_images.forEach(function(img) {
            // Resize the image to 225% of its original size
            var newWidth = img.offsetWidth * 1.9;

            // Check if the new width exceeds the maximum allowed width
            img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
        });

        var webprooftree_images = document.querySelectorAll('.webprooftree img');

        // Loop through each selected image
        webprooftree_images.forEach(function(img) {
            // Resize the image to 225% of its original size
            var newWidth = img.offsetWidth * 1.9;

            // Check if the new width exceeds the maximum allowed width
            img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
        });


        var webcompile_images = document.querySelectorAll('.webcompile img');

        // Loop through each selected image
        webcompile_images.forEach(function(img) {
            // Resize the image to 225% of its original size
            var newWidth = img.offsetWidth * 1.9;

            // Check if the new width exceeds the maximum allowed width
            img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
        });

        var tikzcd_images = document.querySelectorAll('.tikz-cd img');

        // Loop through each selected image
        tikzcd_images.forEach(function(img) {
            // Resize the image
            var newWidth = img.offsetWidth * 1.9;

            // Check if the new width exceeds the maximum allowed width
            img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
        });

        // Select all img tags within divs with class scalemath or tikzcd
        var scalemath_images = document.querySelectorAll('.scalemath img');

        // Loop through each selected image
        scalemath_images.forEach(function(img) {
            // Resize the image to 225% of its original size
            var newWidth = img.offsetWidth * 1.9;

            // Check if the new width exceeds the maximum allowed width
            img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
        });
    };
</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
  let zoomedContainer = null;

  // Select all div elements with class 'scalemath', 'webcompile' or 'tikz-cd'
  const divElements = document.querySelectorAll('.scalemath, .webcompile, .webprooftree, .scalewebprooftree, .tikz-cd');

  divElements.forEach(divElement => {
    divElement.addEventListener('click', (event) => {
      const image = divElement.querySelector('img');

      if (!zoomedContainer) {
        // Create a new container for the zoomed image
        zoomedContainer = document.createElement('div');
        zoomedContainer.className = 'zoom-container';
        
        // Move the image to the new container
        const clonedImage = image.cloneNode(true);
        zoomedContainer.appendChild(clonedImage);
        document.body.appendChild(zoomedContainer);

        // Add click listener to zoom out
        zoomedContainer.addEventListener('click', () => {
          // Restore the image to its original parent
          divElement.appendChild(image);
          document.body.removeChild(zoomedContainer);
          zoomedContainer = null;
        });
      }
      event.stopPropagation();
    });
  });
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', () => {
                const codeBlock = button.previousElementSibling.querySelector('code');
                const textArea = document.createElement('textarea');
                textArea.textContent = codeBlock.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                textArea.remove();
                
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        });
    });
</script>
<script>
// Waits for the HTML AND all resources (images, fonts, etc.)
window.addEventListener('load', (event) => {
    const targetElement = document.querySelector('.current-tag');
    
    // Using the proportional offset method we discussed
    const proportionalOffset = 0.15; // 30% from the top

    if (targetElement) {
        const viewportHeight = window.innerHeight;
        const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
        const desiredPixelOffset = viewportHeight * proportionalOffset;
        const finalScrollPosition = elementPosition - desiredPixelOffset;

        window.scrollTo({
            top: finalScrollPosition,
            behavior: 'smooth' 
        });
    }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Central configuration for PDF links
    const PDF_CONFIG = {
        baseUrls: {
            book: "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/",
            chapter: "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/"
        }
    };

    const theoremStyleDropdown = document.getElementById("theoremStyleSelection");
    const typefaceDropdown = document.getElementById("pdfTypefaceSelection");

    // This function updates ALL PDF links on the page based on the selected styles.
    function updateAllPdfLinks() {
        if (!theoremStyleDropdown || !typefaceDropdown) return; // Exit if elements aren't on the page

        const theoremStyle = theoremStyleDropdown.value;
        const typeface = typefaceDropdown.value;

        // Determine the base filename (stem) from the selections
        let fileStem = typeface;
        if (theoremStyle === 'tcbthm') {
            fileStem += '-tcb';
        }
        
        const bookPdfName = fileStem + '.pdf';
        const chapterDirName = fileStem;

        // 1. Update main book link
        const bookLink = document.getElementById("book-pdf-link");
        if (bookLink) {
            bookLink.href = PDF_CONFIG.baseUrls.book + bookPdfName;
        }

        // 2. Update part link (if it exists on the page)
        const partLink = document.getElementById("part-pdf-link");
        {% if tag is defined %}
        if (partLink) {
            partLink.href = `${PDF_CONFIG.baseUrls.book}${bookPdfName}#nameddest={{ tag.tag }}`;
        }
        {% endif %}

        // 3. Update chapter link (if it exists on the page)
        const chapterLink = document.getElementById("chapter-pdf-link");
        {% if tag is defined and filename is defined %}
        if (chapterLink) {
            chapterLink.href = `${PDF_CONFIG.baseUrls.chapter}${chapterDirName}/{{ filename }}.pdf#nameddest={{ tag.tag }}`;
        }
        {% endif %}

        // 4. Update all chapter links in the Table of Contents
        const tocLinks = document.querySelectorAll('[id^="chapter-pdf-link-in-toc-"]');
        tocLinks.forEach(link => {
            const currentHref = link.getAttribute("href");
            // Extract the base filename (e.g., "01-introduction.pdf") from the end of the URL
            const baseFilename = currentHref.substring(currentHref.lastIndexOf('/') + 1);
            if (baseFilename) {
                 link.href = `${PDF_CONFIG.baseUrls.chapter}${chapterDirName}/${baseFilename}`;
            }
        });
    }
    
    // Function to handle changes in the dropdowns
    function handlePreferenceChange() {
        localStorage.setItem('pdfTheoremStyle', theoremStyleDropdown.value);
        localStorage.setItem('pdfTypeface', typefaceDropdown.value);
        updateAllPdfLinks();
    }

    // Initial load: set dropdowns and update links from localStorage or defaults
    function initializePdfPreferences() {
        if (!theoremStyleDropdown || !typefaceDropdown) return;

        // Attach event listeners
        theoremStyleDropdown.addEventListener("change", handlePreferenceChange);
        typefaceDropdown.addEventListener("change", handlePreferenceChange);
        
        // Retrieve stored preferences or set defaults
        const storedTheoremStyle = localStorage.getItem('pdfTheoremStyle') || 'tcbthm';
        const storedTypeface = localStorage.getItem('pdfTypeface') || 'alegreya-sans';
        
        theoremStyleDropdown.value = storedTheoremStyle;
        typefaceDropdown.value = storedTypeface;

        // Apply preferences on initial load
        updateAllPdfLinks();
    }
    
    initializePdfPreferences();
});
</script>
</body>
</html>
