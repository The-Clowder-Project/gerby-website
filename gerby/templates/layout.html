<!doctype html>
<html lang="en">
<head>


{% import "macros.html" as macros %}

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<meta name="theme-color" content="#8c428a">

<title>{% block title %}{% endblock %}&mdash; The Clowder Project</title>

<meta name="description" content="a collection of personal notes on mathematics and physics">

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/jquery.bonsai.css') }}">
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.bonsai.js') }}"></script>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/discord-widget.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/theorem-environments.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/list-spacing.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/preferences.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/print.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dark-mode.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Noto+Sans+TC:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:ital,wght@0,400;0,500;1,400;1,500&family=Alegreya:ital,wght@0,400;0,700;1,400;1,700&family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Charis+SIL:ital,wght@0,400;0,700;1,400;1,700&family=Crimson+Pro:ital,wght@0,400;0,600;1,400;1,600&family=Crimson+Text:ital,wght@0,400;0,700;1,400;1,700&family=EB+Garamond:ital,wght@0,400;0,700;1,400;1,700&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

{% raw %}
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', () => {
                const codeBlock = button.previousElementSibling.querySelector('code');
                const textArea = document.createElement('textarea');
                textArea.textContent = codeBlock.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                textArea.remove();
                
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        });
    });
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
<script>
window.MathJax = {
  loader: {load: ['[tex]/mathtools','[tex]/require','[tex]/color','[tex]/configmacros','[tex]/html','[tex]/centernot']},
  tex: {
    macros: {
      linebreak: ["", 1, ""],
      webleft: ["\\mathopen{}\\left #1", 1],
      webright: ["\\right #1\\mathclose{}", 1]
    },
    tagSide: 'right',
    inlineMath: [['$','$']],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    packages: ['base', 'ams', 'mathtools', 'configmacros', 'require', 'color', 'html', 'centernot']
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
{% endraw %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" integrity="sha384-yBEPaZw444dClEfen526Q6x4nwuzGO6PreKpbRVSLFCci3oYGE5DnD1pNsubCxYW" crossorigin="anonymous">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js" integrity="sha384-cd07Jx5KAMCf7qM+DveFKIzHXeCSYUrai+VWCPIXbYL7JraHMFL/IXaCKbLtsxyB" crossorigin="anonymous"></script>

<link rel="icon" type="image/vnd.microsoft.icon" href="/static/images/favicon.png">
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/static/images/favicon.png">

{% block head %}{% endblock %}

<style>
table {
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: center;
  padding: 4px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}

.dark-mode tr:nth-child(even) {
  background-color: #1F1F1F;
}
</style>
</head>
<body>
<div id="preferencesMenu" class="preferences">
    <div>
        <div class="preferences-header">Preferences</div>
        <button id="closeButton" class="close-btn">&times;</button>
        <div class="btn-container" style="display: flex !important;">
            <span id="sun" class="material-symbols-outlined"></span><div>  </div>
            <label class="switch btn-color-mode-switch">
                <input type="checkbox" name="color_mode" id="color_mode" value="0">
                <label for="color_mode" data-on="Dark" data-off="Light" class="btn-color-mode-switch-inner"></label>
            </label>
            <div>  </div><span id="moon" class="material-symbols-outlined"></span>
        </div>
        <div class="preference-item"><div>Font: </div>
            <select id="fontSelection">
                <option value="Noto Sans">Noto Sans</option>
                <option value="Alegreya Sans">Alegreya Sans</option>
                <option value="Atkinson Hyperlegible">Atkinson Hyperlegible</option>
                <option value="Alegreya">Alegreya</option>
                <option value="Charis SIL">Charis SIL</option>
                <option value="Crimson Pro">Crimson Pro</option>
                <option value="Crimson Text">Crimson Text</option>
                <option value="EB Garamond">EB Garamond</option>
                <option value="PT Serif">PT Serif</option>
            </select>
        </div>
        <div class="preference-item"><div>PDF Style: </div>
            <select id="styleSelection">
                <option value="Style1">Style 1</option>
                <option value="Style2">Style 2</option>
                <option value="Style3">Style 3</option>
                <option value="Style4">Style 4</option>
            </select>
        </div>
        <hr>
        <p style="text-align:left;">Here's a breakdown of the differences between each PDF style:</p>
        <table>
          <tr>
            <th>Style</th>
            <th>Class</th>
            <th>Font</th>
            <th>Theorem Environments</th>
          </tr>
          <tr>
            <td>Style 1</td>
            <td><code>book</code></td>
            <td>Alegreya Sans</td>
            <td><code>tcbthm</code></td>
          </tr>
          <tr>
            <td>Style 2</td>
            <td><code>book</code></td>
            <td>Alegreya Sans</td>
            <td><code>amsthm</code></td>
          </tr>
          <tr>
            <td>Style 3</td>
            <td><code>book</code></td>
            <td>Arno*</td>
            <td><code>amsthm</code></td>
          </tr>
          <tr>
            <td>Style 4</td>
            <td><code>book</code></td>
            <td>Computer Modern</td>
            <td><code>amsthm</code></td>
          </tr>
        </table>
        <p style="text-align:left;">*To be replaced with Linus Romer's <a href="https://typedrawers.com/discussion/2630/elemaints-a-serif-family-with-optical-sizes">Elemaints</a> when it is released.</p>
    </div>
</div>
<div class="main-content">
  <div class="container-fluid bounded">
    <div id="first-bar" class="row topbar inner-top top">
      <header class="col">
        <h1><a href="/"><div class="title">The Clowder Project</div></a></h1>
      </header>
  
      <nav id="header">
        <ul id="quicklinks">
          <li><div class="push-up"><a href="/">Home</a></div>
          <!--<li><div class="push-up"><a href="/about">About</a></div>-->
          <li><div class="push-up"><a href="/changes">Changes</a></div>
          <li><div class="push-up"><a href="/bibliography">Bibliography</a></div>
          <li><button id="settingsButton"><span class="material-symbols-outlined"></span></button> <!-- Gear Symbol -->
          <!--<li><a href="https://www.math.columbia.edu/~dejong/wordpress/">blog</a>-->
        </ul>
  
        <!--<form id="quicksearch" action="/search">-->
        <!--  <span id="search-icon"><img src="/static/images/search.svg"></span>-->
        <!--  <input type="search" name="query" size="16" placeholder="(this doesn't work)"{% if index %} autofocus{% endif %} value="{{ query }}">-->
        <!--</form>-->
      </nav>
    </div>
  
    <nav id="second-bar" class="row topbar sticky-top">
      {% if self.breadcrumb() %}
        <ul class="col-11 col-sm-11 col-md-11 col-lg-12 col-xl-12" id="crumbs">
          <li><a href="/browse">Table of Contents</a></li>
          {% block breadcrumb %}{% endblock %}
        </ul>
      {% endif %}
  
      {% if self.hamburger() %}
        <div class="col-1 col-sm-1 col-md-1" id="burger">
          <input type="checkbox" id="burger-input"></input>
  
          <label id="burger-icon" for="burger-input">
            <span id="top-bun"></span>
            <span id="meat"></span>
            <span id="bottom-bun"></span>
          </label>
  
          <div id="burger-content">
            {% block hamburger %}{% endblock %}
          </div>
        </div>
      {% endif %}
  
      {% if self.tagline() %}
        {% block tagline %}{% endblock %}
      {% endif %}
    </nav>
  
    <div class="row" id="content">
      <section id="main" class="col-xs-12 col-sm-12 col-md-12 col-lg-8 col-xl-8">
        {% block body %}{% endblock %}
      </section>
        <div class="col-lg-4 col-xl-4">
          <section id="meta" class="row topbar sticky-top">
          {% if tag is defined %}
            <div class="right-interaction-box">
          {% endif %}
          {% block sidebar %}{% endblock %}
          {% if tag is defined %}
            </div>
            <hr>
            <div class="contact-box">
                <p>Noticed something off, or have any comments? Feel free to reach out!</p>
                <ul>
                    <li><a class="no-bg" href="mailto:emily.de.oliveira.santos.tmf@gmail.com">Email <span class="dark-svg"><img class="email-icon" src="/static/images/email.svg"></span></a>
                    <li><a href="https://twitter.com/emily_etale">Twitter <span class="dark-svg"><img class="twitter-icon" src="/static/images/twitter.svg"></span></a>
                    <li><a href="https://discord.gg/b98uG2MWgc">Discord <span class="dark-svg"><img class="discord-icon" src="/static/images/discord.svg"></span></a>
                </ul>
                <hr>
                You can also use the contact form below:
                <br>
                <div class="contact-form-container">
                  <div class="columns">
                    <div class="column is-half">
                      <form action="https://api.staticforms.xyz/submit" method="post" id="staticform">
                        <input type="hidden" name="accessKey" value="406a3bad-091e-4921-87a3-1a564e044b6b">
                        <input type="hidden" name="subject" value="New comment from the Clowder Project">
                        <div class="field">
                          <label class="contact-label"><b>Name</b></label>
                          <div class="control">
                            <input class="input" type="text" name="name" placeholder="Enter Your Name" required>
                          </div>
                        </div>
                        <div class="field">
                          <label class="contact-label"><b>Email</b></label>
                          <div class="control">
                            <input class="input" type="email" name="email" placeholder="Enter Your Email" required>
                          </div>
                        </div>
                        <div class="field">
                          <label class="contact-label"><b>Message</b></label>
                          <div class="control">
                            <textarea class="textarea" name="message" placeholder="Enter Your Message" required></textarea>
                          </div>
                        </div>
                        <button class="contact-form-submit-button button is-primary" type="Submit">Submit</button>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
          {% endif %}
        </section>
      </div>
    </div>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.bundle.min.js" integrity="sha384-3ziFidFTgxJXHMDttyPJKDuTlmxJlwbSkojudK/CkRqKDOmeSbN6KLrGdrBQnT2n" crossorigin="anonymous"></script>
  </div>
  <div id="footnote-box" class="hidden">
      <span id="footnote-content"></span>
  </div>
  {% raw %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function initializeSlideshow(slideshowId) {
                const container = document.getElementById(slideshowId);
                const slideshowImage = container.querySelector('.slideshow-image');
                const prevButton = container.querySelector('.slideshow-button-container #prev-slideshow-button');
                const nextButton = container.querySelector('.slideshow-button-container #next-slideshow-button');

                if (!slideshowImage || !prevButton || !nextButton) {
                    return null;
                }

                let currentSlide = 1;

                function padNumber(number) {
                    return number.toString().padStart(2, '0');
                }

                function getImageUrl(slideNumber) {
                    let currentSrc = slideshowImage.src;
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    
                    const parts = currentSrc.split('/');
                    const fileName = parts.pop();
                    let path = parts.join('/');

                    if (isDarkMode) {
                        if (!path.includes('/dark-mode')) {
                            path += '/dark-mode';
                        }
                    } else {
                        path = path.replace('/dark-mode', '');
                    }

                    const newFileName = fileName.replace(/^\d+/, padNumber(slideNumber));
                    return `${path}/${newFileName}`;
                }

                function imageExists(url) {
                    return new Promise((resolve) => {
                        const img = new Image();
                        img.onload = () => resolve(true);
                        img.onerror = () => resolve(false);
                        img.src = url;
                    });
                }

                async function updateImage(direction) {
                    const newSlide = direction === 'next' ? currentSlide + 1 : currentSlide - 1;
                    const newImageUrl = getImageUrl(newSlide);

                    if (await imageExists(newImageUrl)) {
                        currentSlide = newSlide;
                        slideshowImage.src = newImageUrl;
                    }
                }

                async function nextSlide() {
                    await updateImage('next');
                }

                async function prevSlide() {
                    if (currentSlide > 1) {
                        await updateImage('prev');
                    }
                }

                async function updateImageForCurrentMode() {
                    const newImageUrl = getImageUrl(currentSlide);
                    if (await imageExists(newImageUrl)) {
                        slideshowImage.src = newImageUrl;
                    }
                }

                prevButton.addEventListener('click', prevSlide);
                nextButton.addEventListener('click', nextSlide);

                return { updateImageForCurrentMode };
            }

            // Initialize slideshows
            const slideshowIds = ['slideshow-1', 'slideshow-2', 'slideshow-3', 'slideshow-4'];

            // Filter IDs for existing elements first, then initialize
            const existingSlideshows = slideshowIds
                .filter(id => document.getElementById(id))
                .map(initializeSlideshow)
                .filter(Boolean);

            // Function to run whenever the "dark-mode" class is added or removed
            function onDarkModeChange() {
                if (typeof slideshows !== "undefined" && Array.isArray(slideshows)) {
                    slideshows.forEach(slideshow => slideshow.updateImageForCurrentMode());
                } else {
                    console.log("slideshow is undefined");
                }
            }

            // Create a new MutationObserver to watch for changes
            const observer = new MutationObserver((mutationsList) => {
                mutationsList.forEach(mutation => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        // Check if the dark-mode class has been added or removed
                        if (mutation.target.classList.contains('dark-mode')) {
                            console.log("Dark mode enabled");
                        } else {
                            console.log("Dark mode disabled");
                        }
                        onDarkModeChange();
                    }
                });
            });

            // Start observing the body element for attribute changes (in this case, class changes)
            const body = document.querySelector('body');
            observer.observe(body, {
                attributes: true, // Observe changes to attributes
                attributeFilter: ['class'] // Only observe the 'class' attribute
            });
            if (typeof slideshows !== "undefined" && Array.isArray(slideshows)) {
                console.log("Slideshows initialized:", slideshows.length);
            } else {
                console.log("Slideshows not initialized.");
            }
        });
    </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const moonElement = document.getElementById('moon');
        const sunElement = document.getElementById('sun');
        if (document.body.classList.contains('dark-mode')) {
            if (moonElement) {
                moonElement.style.color = '#ffffff';
                moonElement.style.textShadow = '0 0 8px #ffffff, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)';
                sunElement.style.color = '';
                sunElement.style.textShadow = '';
            }
        } else {
            if (moonElement) {
                moonElement.style.color = '';
                moonElement.style.textShadow = '';
                sunElement.style.color = '#EB9B34';
                sunElement.style.textShadow = '0 0 8px #EB9B34, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)';
            }
        }
    });
    const observer = new MutationObserver(() => {
        const moonElement = document.getElementById('moon');
        const sunElement = document.getElementById('sun');
        if (document.body.classList.contains('dark-mode')) {
            if (moonElement) {
                moonElement.style.color = '#ffffff';
                moonElement.style.textShadow = '0 0 8px #ffffff, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)';
                sunElement.style.color = '';
                sunElement.style.textShadow = '';
            }
        } else {
            if (moonElement) {
                moonElement.style.color = '';
                moonElement.style.textShadow = '';
                sunElement.style.color = '#EB9B34';
                sunElement.style.textShadow = '0 0 8px #EB9B34, 0 0 12px #ffffff, 0 0 16px rgba(173, 216, 230, 0.8)';
            }
        }
    });
    
    // Start observing the `body` for attribute changes
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  </script>
  <script>
    function initializeCounters() {
        // Define counter types based on nesting depth
        const counterTypes = ['decimal', 'alpha', 'roman', 'uppercaseRoman'];

        // Helper function to get counter text based on type and value
        function getCounterText(type, value) {
            if (type === 'decimal') {
                return value + '.';
            } else if (type === 'alpha') {
                // 'a' is 97 in ASCII
                return '(' + String.fromCharCode(96 + value) + ')';
            } else if (type === 'roman') {
                const romanNumerals = [
                    'i', 'ii', 'iii', 'iv', 'v', 'vi', 'vii', 'viii', 'ix', 'x',
                    'xi', 'xii', 'xiii', 'xiv', 'xv', 'xvi', 'xvii', 'xviii', 'xix', 'xx'
                ];
                return '(' + (romanNumerals[value - 1] || value) + ')';
            } else if (type === 'uppercaseRoman') {
                const upperRomanNumerals = [
                    'I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX', 'X',
                    'XI', 'XII', 'XIII', 'XIV', 'XV', 'XVI', 'XVII', 'XVIII', 'XIX', 'XX'
                ];
                return '(' + (upperRomanNumerals[value - 1] || value) + ')';
            }
            // Add more types if needed
        }

        // Global counters object
        const counters = {};

        // Variable to track whether we are inside an article
        let insideArticle = false;

        // Recursive function to process elements
        function processElements(element, depth) {
            // Check for article boundaries
            if (element.tagName === 'ARTICLE') {
                // When entering an article, reset counters
                insideArticle = true;
                resetAllCounters();
            }

            // Reset counters if <div class="p-proof"> or <div class="footnotes-section"> is encountered
            if (
                element.classList &&
                (element.classList.contains('p-proof') || element.classList.contains('footnotes-section'))
            ) {
                resetAllCounters();
            }

            // Reset counters for index page
            if (element.textContent && element.textContent.includes('who is thereby charged with')) {
                resetAllCounters();
            }

            // Process child nodes
            const childNodes = element.childNodes;
            childNodes.forEach(child => {
                if (child.nodeType === Node.ELEMENT_NODE) {
                    // If the child is an <ol> or <ul>, process it as a list
                    if (child.tagName === 'OL' || child.tagName === 'UL') {
                        processList(child, depth);
                    } else {
                        // Recurse into child elements
                        processElements(child, depth);
                    }
                }
            });

            // Check for article end
            if (element.tagName === 'ARTICLE') {
                // When exiting an article, reset counters
                insideArticle = false;
                resetAllCounters();
            }
        }

        // Function to reset all counters
        function resetAllCounters() {
            for (let d = 1; d <= counterTypes.length; d++) {
                counters[d] = 1;
            }
        }

        // Recursive function to process a list
        function processList(listElement, depth) {
            if (depth > counterTypes.length) return; // Limit to defined counter types

            const counterType = counterTypes[depth - 1];

            // Initialize counter for this depth if not already
            if (!counters.hasOwnProperty(depth)) {
                counters[depth] = 1;
            }

            const items = listElement.children;
            for (const item of items) {
                if (item.tagName !== 'LI') continue;

                // Reset counters for deeper levels when starting a new list item
                for (let d = depth + 1; d <= counterTypes.length; d++) {
                    counters[d] = 1;
                }

                // Assign counter text to elements with class 'counter-inner' or 'counter-inner-no-pointer'
                const counterElements = item.querySelectorAll('.counter-inner, .counter-inner-no-pointer');
                counterElements.forEach(element => {
                    element.textContent = getCounterText(counterType, counters[depth]);
                });

                // Increment counter for current depth after assigning the counter text
                counters[depth]++;

                // Process any child elements (including nested lists and divs)
                processElements(item, depth + 1);
            }
        }

        // Start processing from the <section id="main">
        const mainSection = document.getElementById('main');
        if (mainSection) {
            processElements(mainSection, 1);
        } else {
            console.warn('No element with id="main" found.');
        }
    }

    // Initialize counters on document load
    document.addEventListener("DOMContentLoaded", function() {
        initializeCounters();

        // Footnote handling remains unchanged
        var footnotes = document.querySelectorAll(".footnote");
        var footnoteBox = document.getElementById("footnote-box");

        footnotes.forEach(function(footnote) {
            footnote.addEventListener("mouseover", function(event) {
                var content = footnote.getAttribute("data-content");
                document.getElementById("footnote-content").innerHTML = content;
                var rect = footnote.getBoundingClientRect();
                footnoteBox.style.left = rect.left + "px";
                footnoteBox.style.top = (rect.top + rect.height + window.scrollY) + "px";
                footnoteBox.classList.remove("hidden");

                // Process counters within the footnote content
                initializeCounters();
                MathJax.typeset();
            });

            footnote.addEventListener("mouseout", function() {
                setTimeout(() => {
                    if (!footnoteBox.matches(':hover')) {
                        closeFootnote();
                    }
                }, 100);
            });
        });

        footnoteBox.addEventListener("mouseover", function() {
            clearTimeout(closeFootnote);
        });

        footnoteBox.addEventListener("mouseout", function() {
            closeFootnote();
        });
    });

    function closeFootnote() {
        document.getElementById("footnote-box").classList.add("hidden");
    }
  </script>
  <script>
      window.onload = function() {
          // Maximum allowed width for images
          var maxWidth = 550; // You can adjust this value as per your requirement
  
          // Select all img tags within divs with class webcompile or tikzcd
          var webcompile_images = document.querySelectorAll('.webcompile img');
  
          // Loop through each selected image
          webcompile_images.forEach(function(img) {
              // Resize the image to 225% of its original size
              var newWidth = img.offsetWidth * 2.0;
  
              // Check if the new width exceeds the maximum allowed width
              img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
          });
  
          var tikzcd_images = document.querySelectorAll('.tikz-cd img');
  
          // Loop through each selected image
          tikzcd_images.forEach(function(img) {
              // Resize the image
              var newWidth = img.offsetWidth * 2.0;
  
              // Check if the new width exceeds the maximum allowed width
              img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
          });

          // Select all img tags within divs with class scalemath or tikzcd
          var scalemath_images = document.querySelectorAll('.scalemath img');
  
          // Loop through each selected image
          scalemath_images.forEach(function(img) {
              // Resize the image to 225% of its original size
              var newWidth = img.offsetWidth * 2.0;
  
              // Check if the new width exceeds the maximum allowed width
              img.style.width = (newWidth > maxWidth ? maxWidth : newWidth) + 'px';
          });
      };
  </script>
  <script>
  document.addEventListener('click', function(event) {
      let menu = document.getElementById('preferencesMenu');
      let button = document.getElementById('settingsButton');
  
      if (!menu.contains(event.target) && !button.contains(event.target)) {
          menu.style.display = 'none';
      }
  });
  document.addEventListener('keydown', function(event) {
      if (event.key == 'Escape') {
          let menu = document.getElementById('preferencesMenu');
          let body = document.body;
          var mainContent = document.querySelector('.main-content');
          //
          menu.style.display = 'none';
          body.classList.remove('darkened'); // Restore body's original look
          body.classList.remove('lightened'); // Restore body's original look
          mainContent.style.pointerEvents = "auto";
      }
  });
  </script>
  <script>
  // This function returns the font size based on the font name
  function getFontSizeForFont(fontName) {
      return {
          title: {
              'Alegreya Sans': '16pt',
              'Alegreya': '15pt',
              'Atkinson Hyperlegible': '14.5pt',
              'Charis SIL': '14pt',
              'Crimson Pro': '16pt',
              'Crimson Text': '16pt',
              'Noto Sans': '12pt',
              'EB Garamond': '16pt',
              'PT Serif': '14pt',
          },
          body: {
              'Alegreya Sans': '14pt',
              'Alegreya': '13pt',
              'Atkinson Hyperlegible': '12.5pt',
              'Charis SIL': '12pt',
              'Crimson Pro': '14pt',
              'Crimson Text': '14pt',
              'Noto Sans': '12pt',
              'EB Garamond': '14pt',
              'PT Serif': '12pt',
          },
          preferencesMenu: {
              'Alegreya Sans': '14pt',
              'Alegreya': '13pt',
              'Atkinson Hyperlegible': '12.5pt',
              'Charis SIL': '12pt',
              'Crimson Pro': '14pt',
              'Crimson Text': '14pt',
              'Noto Sans': '12pt',
              'EB Garamond': '14pt',
              'PT Serif': '12pt',
          }
      };
  }
  
  function setFont(fontChoice) {
    let fontSizes = getFontSizeForFont(fontChoice);

    document.body.style.fontFamily = fontChoice;
    // Check if the device is a mobile device
    const mediaQuery = window.matchMedia('(max-width: 767px)');

    if (mediaQuery.matches) {
      document.body.style.fontSize = fontSizes.body[fontChoice] * 0.7 + 'pt';
    } else {
      document.body.style.fontSize = fontSizes.body[fontChoice];
    }

    let preferencesMenu = document.getElementById('preferencesMenu');
    if (preferencesMenu) {
        preferencesMenu.style.fontSize = fontSizes.preferencesMenu[fontChoice];
    }
  }
  
  if (localStorage.getItem('font')) {
      let fontChoice = localStorage.getItem('font');
      setFont(fontChoice);
      document.getElementById('fontSelection').value = fontChoice;
  }
  
  // Assuming you also have an event listener to change the font when the user selects a new font
  document.getElementById('fontSelection').addEventListener('change', function() {
      let selectedFont = this.value;
      setFont(selectedFont);
      localStorage.setItem('font', selectedFont);
  });
  
  // Listener for settings button
  document.getElementById('settingsButton').addEventListener('click', function(event) {
      let menu = document.getElementById('preferencesMenu');
      let body = document.body;
  
      if (menu.style.display === "none" || menu.style.display === "") {
          menu.style.display = "block";
          // Check if the body has the "dark-mode" class
          if (body.classList.contains('dark-mode')) {
              body.classList.add('darkened'); // Darken the body for dark mode
          } else {
              body.classList.add('lightened'); // Lighten the body for light mode
          }
          var mainContent = document.querySelector('.main-content');
          mainContent.style.pointerEvents = "none";
          event.stopPropagation();
      }
  });
  
  document.addEventListener('click', function(event) {
      let menu = document.getElementById('preferencesMenu');
      let button = document.getElementById('settingsButton');
      let body = document.body;
  
      if (!menu.contains(event.target) && !button.contains(event.target)) {
          menu.style.display = 'none';
          body.classList.remove('darkened'); // Restore body's original look
          body.classList.remove('lightened'); // Restore body's original look
          var mainContent = document.querySelector('.main-content');
          mainContent.style.pointerEvents = "auto";
      }
  });
  
  // Close button listener
  document.getElementById('closeButton').addEventListener('click', function() {
      let menu = document.getElementById('preferencesMenu');
      let body = document.body;
      menu.style.display = 'none';
      body.classList.remove('lightened'); // Restore body's original look
      body.classList.remove('darkened'); // Restore body's original look
      var mainContent = document.querySelector('.main-content');
      mainContent.style.pointerEvents = "auto";
  });
  </script>
  {% endraw %}
</div>
{% raw %}
<script>
$(document).ready(function() {
    // Check initial state
    colorModePreview($("#color_mode"));

    $("#color_mode").on("change", function () {
        colorModePreview(this);
        $('body').removeClass('lightened');
        $('body').removeClass('darkened');
    });
});

function colorModePreview(ele) {
    // Function to replace image src based on mode
    function replaceImgSrc(content, isDarkMode) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(content, 'text/html');

        doc.querySelectorAll('img').forEach(img => {
            const tikzPath = '/static/tikzcd-images/';
            const webCompilePath = '/static/webcompile-images/';
            const scaleMathPath = '/static/scalemath-images/';

            if (img.src.includes(tikzPath) && isDarkMode && !img.src.includes(tikzPath + 'dark-mode/')) {
                img.src = img.src.replace(tikzPath, tikzPath + 'dark-mode/');
            } else if (img.src.includes(tikzPath + 'dark-mode/') && !isDarkMode) {
                img.src = img.src.replace(tikzPath + 'dark-mode/', tikzPath);
            }

            if (img.src.includes(webCompilePath) && isDarkMode && !img.src.includes(webCompilePath + 'dark-mode/')) {
                img.src = img.src.replace(webCompilePath, webCompilePath + 'dark-mode/');
            } else if (img.src.includes(webCompilePath + 'dark-mode/') && !isDarkMode) {
                img.src = img.src.replace(webCompilePath + 'dark-mode/', webCompilePath);
            }

            if (img.src.includes(scaleMathPath) && isDarkMode && !img.src.includes(scaleMatPath + 'dark-mode/')) {
                img.src = img.src.replace(scaleMatPath, scaleMatPath + 'dark-mode/');
            } else if (img.src.includes(scaleMatPath + 'dark-mode/') && !isDarkMode) {
                img.src = img.src.replace(scaleMatPath + 'dark-mode/', scaleMatPath);
            }
        });

        const serializer = new XMLSerializer();
        return serializer.serializeToString(doc.body);
    }
    function adjustImgSrcForDarkMode(selector, basePath, isDarkMode) {
        $(selector).each(function() {
            if (isDarkMode && this.src.includes(basePath) && !this.src.includes(basePath + 'dark-mode/')) {
                this.src = this.src.replace(basePath, basePath + 'dark-mode/');
            } else if (!isDarkMode && this.src.includes(basePath + 'dark-mode/')) {
                this.src = this.src.replace(basePath + 'dark-mode/', basePath);
            }
        });
    }

    if($(ele).prop("checked") == true){
        $('body').addClass('dark-mode');
        $('body').removeClass('light-mode');
        // Modify data-content for footnotes
        const footnotes = document.querySelectorAll('.footnote');
        footnotes.forEach(footnote => {
            const content = footnote.getAttribute('data-content');
            const updatedContent = replaceImgSrc(content, true);
            footnote.setAttribute('data-content', updatedContent);
        });
        // Adjust img src in the actual DOM
        adjustImgSrcForDarkMode('.tikz-cd > img', '/static/tikzcd-images/', true);
        adjustImgSrcForDarkMode('.webcompile > img', '/static/webcompile-images/', true);
        adjustImgSrcForDarkMode('.scalemath > img', '/static/scalemath-images/', true);
        //
        let menu = document.getElementById('preferencesMenu');
        if(menu.style.display == 'block') {
            $('body').removeClass('lightened');
            $('body').addClass('darkened');
        }
    }
    else if($(ele).prop("checked") == false){
        $('body').addClass('light-mode');
        $('body').removeClass('dark-mode');
        // Modify data-content for footnotes
        const footnotes = document.querySelectorAll('.footnote');
        footnotes.forEach(footnote => {
            const content = footnote.getAttribute('data-content');
            const updatedContent = replaceImgSrc(content, false);
            footnote.setAttribute('data-content', updatedContent);
        });
        let imgElement = document.querySelector('.tikz-cd > img');
        // Adjust img src in the actual DOM
        adjustImgSrcForDarkMode('.tikz-cd > img', '/static/tikzcd-images/', false);
        adjustImgSrcForDarkMode('.webcompile > img', '/static/webcompile-images/', false);
        adjustImgSrcForDarkMode('.scalemath > img', '/static/scalemath-images/', false);
        //
        let menu = document.getElementById('preferencesMenu');
        if(menu.style.display == 'block') {
            $('body').removeClass('darkened');
            $('body').addClass('lightened');
        }
    }
}
$(document).ready(function() {
    // Load user's theme preference from localStorage
    const userPrefersDark = localStorage.getItem('theme') === 'dark';
    $("#color_mode").prop("checked", userPrefersDark);
    colorModePreview($("#color_mode"));

    $("#color_mode").on("change", function () {
        colorModePreview(this);
        localStorage.setItem('theme', $(this).prop("checked") ? 'dark' : 'light');
    });
});
</script>
{% endraw %}
{% if tag is defined %}
<script>
    // PDF Style Selection
    if (localStorage.getItem('pdfStyle')) {
        let pdfChoice = localStorage.getItem('pdfStyle');
        setPDFStyle(pdfChoice);
        document.getElementById('styleSelection').value = pdfChoice;
    }
    // Assuming you also have an event listener to change the pdf style when the user selects a new pdf stlye
    document.getElementById('styleSelection').addEventListener('change', function() {
        let pdfChoice = this.value;
        setPDFStyle(pdfChoice);
        localStorage.setItem('pdfStyle', pdfChoice);
    });
    function setPDFStyle(pdfChoice) {
        // Get the link element
        var link = document.getElementById("part-pdf-link");

        try  {
            // Update the href attribute based on the selected value
            if (pdfChoice === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    }
    // Get the dropdown menu element
    var dropdown = document.getElementById("styleSelection");

    // Add an event listener to detect changes in the selected value
    dropdown.addEventListener("change", function() {
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("part-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    });
    window.addEventListener('load', function() {
        let pdfChoice = localStorage.getItem('pdfStyle');
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("part-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    });
</script>
{% endif %}
{% raw %}
<script>
    // PDF Style Selection
    if (localStorage.getItem('pdfStyle')) {
        let pdfChoice = localStorage.getItem('pdfStyle');
        setPDFStyle(pdfChoice);
        document.getElementById('styleSelection').value = pdfChoice;
    }
    // Assuming you also have an event listener to change the pdf style when the user selects a new pdf stlye
    document.getElementById('styleSelection').addEventListener('change', function() {
        let pdfChoice = this.value;
        setPDFStyle(pdfChoice);
        localStorage.setItem('pdfStyle', pdfChoice);
    });
    function setPDFStyle(pdfChoice) {
        // Get the link element
        var link = document.getElementById("book-pdf-link");

        try  {
            // Update the href attribute based on the selected value
            if (pdfChoice === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf";
            } else if (pdfChoice === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf";
            } else if (pdfChoice === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf";
            } else if (pdfChoice === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf";
            }
        } catch(err) {
            //do nothing
        }
    }
    // Get the dropdown menu element
    var dropdown = document.getElementById("styleSelection");

    // Add an event listener to detect changes in the selected value
    dropdown.addEventListener("change", function() {
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("book-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf";
            }
        } catch(err) {
            //do nothing
        }
    });
    window.addEventListener('load', function() {
        let pdfChoice = localStorage.getItem('pdfStyle');
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("book-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans-tcb.pdf";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/alegreya-sans.pdf";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/arno.pdf";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-book/cm.pdf";
            }
        } catch(err) {
            //do nothing
        }
    });
</script>
{% endraw %}
{% if tag is defined %}
<script> // PDF Style Selection
    if (localStorage.getItem('pdfStyle')) {
        let pdfChoice = localStorage.getItem('pdfStyle');
        setPDFStyle(pdfChoice);
        document.getElementById('styleSelection').value = pdfChoice;
    }
    // Assuming you also have an event listener to change the pdf style when the user selects a new pdf stlye
    document.getElementById('styleSelection').addEventListener('change', function() {
        let pdfChoice = this.value;
        setPDFStyle(pdfChoice);
        localStorage.setItem('pdfStyle', pdfChoice);
    });
    function setPDFStyle(pdfChoice) {
        // Get the link element
        var link = document.getElementById("chapter-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (pdfChoice === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (pdfChoice === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    }
    // Get the dropdown menu element
    var dropdown = document.getElementById("styleSelection");

    // Add an event listener to detect changes in the selected value
    dropdown.addEventListener("change", function() {
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("chapter-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    });
    window.addEventListener('load', function() {
        let pdfChoice = localStorage.getItem('pdfStyle');
        // Get the selected value
        var selectedValue = dropdown.value;

        // Get the link element
        var link = document.getElementById("chapter-pdf-link");

        // Update the href attribute based on the selected value
        try {
            if (selectedValue === "Style1") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style2") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style3") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            } else if (selectedValue === "Style4") {
                link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/{{ filename }}.pdf#nameddest={{ tag.tag }}";
            }
        } catch(err) {
            //do nothing
        }
    });
</script>
{% endif %}
<script> // PDF Style Selection
    var links = document.querySelectorAll('[id^="chapter-pdf-link-in-toc-"]');

    links.forEach(function(link) {
        var href = link.getAttribute("href");
        href = href.slice(22)
        console.log(href)

        if (localStorage.getItem('pdfStyle')) {
            let pdfChoice = localStorage.getItem('pdfStyle');
            setPDFStyle(pdfChoice);
            document.getElementById('styleSelection').value = pdfChoice;
        }
        // Assuming you also have an event listener to change the pdf style when the user selects a new pdf stlye
        document.getElementById('styleSelection').addEventListener('change', function() {
            let pdfChoice = this.value;
            setPDFStyle(pdfChoice);
            localStorage.setItem('pdfStyle', pdfChoice);
        });
        function setPDFStyle(pdfChoice) {
            // Get the link element
            //var link = document.getElementById("chapter-pdf-link-in-toc");

            // Update the href attribute based on the selected value
            try {
                if (pdfChoice === "Style1") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/"+href+".pdf";
                } else if (pdfChoice === "Style2") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/"+href+".pdf";
                } else if (pdfChoice === "Style3") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/"+href+".pdf";
                } else if (pdfChoice === "Style4") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/"+href+".pdf";
                }
            } catch(err) {
                //do nothing
            }
        }
        // Get the dropdown menu element
        var dropdown = document.getElementById("styleSelection");

        // Add an event listener to detect changes in the selected value
        dropdown.addEventListener("change", function() {
            // Get the selected value
            var selectedValue = dropdown.value;

            // Get the link element
            //var link = document.getElementById("chapter-pdf-link-in-toc");

            // Update the href attribute based on the selected value
            try {
                if (selectedValue === "Style1") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/"+href+".pdf";
                } else if (selectedValue === "Style2") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/"+href+".pdf";
                } else if (selectedValue === "Style3") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/"+href+".pdf";
                } else if (selectedValue === "Style4") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/"+href+".pdf";
                }
            } catch(err) {
                //do nothing
            }
        });
        window.addEventListener('load', function() {
            let pdfChoice = localStorage.getItem('pdfStyle');
            // Get the selected value
            var selectedValue = dropdown.value;

            // Get the link element
            //var link = document.getElementById("chapter-pdf-link-in-toc");

            // Update the href attribute based on the selected value
            try {
                if (selectedValue === "Style1") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans-tcb/"+href+".pdf";
                } else if (selectedValue === "Style2") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/alegreya-sans/"+href+".pdf";
                } else if (selectedValue === "Style3") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/arno/"+href+".pdf";
                } else if (selectedValue === "Style4") {
                    link.href = "https://raw.githubusercontent.com/topological-modular-forms/clowder-project-output/master/tags-chapters/cm/"+href+".pdf";
                }
            } catch(err) {
                //do nothing
            }
        });
    });
</script>
<script>
$(document).on('shown.bs.popover', '[data-toggle="popover"]', function() {
    let fontChoice = localStorage.getItem('font');
    var fontSizeBody = getFontSizeForFont(fontChoice).body;
    var fontSizeTitle = getFontSizeForFont(fontChoice).title;
    // Get the popover ID from aria-describedby attribute
    var popoverId = $(this).attr('aria-describedby');
    // Access the title and body elements and apply styles
    $('#' + popoverId).find('.no-reference-popover-title').css({
      'font-family': fontChoice,
      'font-size': fontSizeTitle
    });
    $('#' + popoverId).find('.no-reference-popover-content').css({
      'font-family': fontChoice,
      'font-size': fontSizeBody
    });
});
</script>
<script>
function discord() {
    navigator.clipboard.writeText('yui_emily');
    alert('You can message me on Discord using my username, "yui_emily", which has been copied to your clipboard.');
}
</script>
<script>
// find elements
$("#staticform").submit(function(event) {
  event.preventDefault();
  $.ajax({
    url: 'https://api.staticforms.xyz/submit', // url where to submit the request
    type: "POST", // type of action POST || GET
    dataType: 'json', // data type
    data: $("#staticform").serialize(), // post data || get data
    success: function(result) {
      // you can see the result from the console
      // tab of the developer tools
      alert(JSON.parse(result));
    },
    error: function(xhr, resp, text) {
      alert(xhr, resp, text);
    }
  })
});
</script>
<script>
  try  {
    document.getElementById('playButton').addEventListener('click', function() {
        togglePlay('audioPlayer');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButton2').addEventListener('click', function() {
        togglePlay('audioPlayer2');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButtonWasureru1').addEventListener('click', function() {
        togglePlay('audioPlayerWasureru1');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButtonWasureru2').addEventListener('click', function() {
        togglePlay('audioPlayerWasureru2');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButtonWasureru3').addEventListener('click', function() {
        togglePlay('audioPlayerWasureru3');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButtonWasureru4').addEventListener('click', function() {
        togglePlay('audioPlayerWasureru4');
    });
  } catch(err) {
    //do nothing
  }
  try  {
    document.getElementById('playButtonYo').addEventListener('click', function() {
        togglePlay('audioPlayerYo');
    });
  } catch(err) {
    //do nothing
  }
  function togglePlay(audioId) {
      var audio = document.getElementById(audioId);
      if (audio.paused) {
          audio.play();
      } else {
          audio.pause();
          audio.currentTime = 0;
      }
  }
</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
  let zoomedContainer = null;

  // Select all div elements with class 'scalemath', 'webcompile' or 'tikz-cd'
  const divElements = document.querySelectorAll('.scalemath, .webcompile, .tikz-cd');

  divElements.forEach(divElement => {
    divElement.addEventListener('click', (event) => {
      const image = divElement.querySelector('img');

      if (!zoomedContainer) {
        // Create a new container for the zoomed image
        zoomedContainer = document.createElement('div');
        zoomedContainer.className = 'zoom-container';
        
        // Move the image to the new container
        const clonedImage = image.cloneNode(true);
        zoomedContainer.appendChild(clonedImage);
        document.body.appendChild(zoomedContainer);

        // Add click listener to zoom out
        zoomedContainer.addEventListener('click', () => {
          // Restore the image to its original parent
          divElement.appendChild(image);
          document.body.removeChild(zoomedContainer);
          zoomedContainer = null;
        });
      }
      event.stopPropagation();
    });
  });
});
</script>
</body>
</html>
